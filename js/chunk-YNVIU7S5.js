import{I,J as S,R as O,aa as C,c as h,f as k,g as H,h as P,j as B,l as w,m as $,o as N,p as _}from"./chunk-VK2MDE4H.js";import{c as g}from"./chunk-CSYCUVEX.js";g();g();var f={set(r,p){localStorage.setItem(r,p)},get(r){return localStorage.getItem(r)},del(r){localStorage.removeItem(r)}};var D=r=>{if(!r)return;let p=h(_,"div",{innerHTML:r,className:"tip"});setTimeout(()=>{p.addClass("hide"),setTimeout(()=>{_.removeChild(p)},300)},3e3)},ee=()=>{w.auto_scroll&&f.set(S,String($.y))},te=r=>{let p=window.location.hash,c=null;if(I){f.del(S);return}p?c=document.querySelector(decodeURI(p)):c=w.auto_scroll?parseInt(f.get(S)):0,c&&(C(c),O(1)),r&&p&&!I&&(C(c),O(1))},re=(r,p)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(r).then(()=>{p&&p(!0)},()=>{p&&p(!1)}):(console.error("Too old browser, clipborad API not supported."),p&&p(!1))};g();g();var q=null,j=/mobile/i.test(window.navigator.userAgent),ye=(r,p)=>{let c={el:{},create(){r.player.options.btns&&r.player.options.btns.forEach(e=>{c.el[e]||(c.el[e]=h(r,"div",{className:e+" btn",onclick(a){r.player.fetch().then(()=>{r.player.options.events[e](a)})}}))})}},u={el:null,btns:{mode:void 0,volume:void 0},step:"next",create:()=>{if(!r.player.options.controls)return;let e=u;r.player.options.controls.forEach(a=>{if(e.btns[a])return;let t={onclick(d){e.events[a]?e.events[a](d):r.player.options.events[a](d)}};switch(a){case"volume":t.className=" "+(i.muted?"off":"on"),t.innerHTML='<div class="bar"></div>',t["on"+m.nameMap.dragStart]=e.events.volume,t.onclick=null;break;case"mode":t.className=" "+r.player.options.mode;break;default:t.className="";break}t.className=a+t.className+" btn",e.btns[a]=h(e.el,"div",t)}),e.btns.volume.bar=e.btns.volume.querySelector(".bar")},events:{mode(e){switch(r.player.options.mode){case"loop":r.player.options.mode="random";break;case"random":r.player.options.mode="order";break;default:r.player.options.mode="loop"}u.btns.mode.className="mode "+r.player.options.mode+" btn",f.set("_PlayerMode",r.player.options.mode)},volume(e){e.preventDefault();let a=e.currentTarget,t=!1,d=o=>{o.preventDefault(),r.player.volume(u.percent(o,a)),t=!0},s=o=>{o.preventDefault(),a.removeEventListener(m.nameMap.dragEnd,s),a.removeEventListener(m.nameMap.dragMove,d),t?(r.player.muted(),r.player.volume(u.percent(o,a))):i.muted?(r.player.muted(),r.player.volume(i.volume)):(r.player.muted("muted"),u.update(0))};a.addEventListener(m.nameMap.dragMove,d),a.addEventListener(m.nameMap.dragEnd,s)},backward(e){u.step="prev",r.player.mode()},forward(e){u.step="next",r.player.mode()}},update(e){u.btns.volume.className="volume "+(!i.muted&&e>0?"on":"off")+" btn",k(u.btns.volume.bar,Math.floor(e*100)+"%")},percent(e,a){let t=((e.clientX||e.changedTouches[0].clientX)-P(a))/H(a);return t=Math.max(t,0),Math.min(t,1)}},l={el:null,bar:null,create(){let e=n.current().el;e&&(l.el&&(l.el.parentNode.removeClass("current").removeEventListener(m.nameMap.dragStart,l.drag),l.el.remove()),l.el=h(e,"div",{className:"progress"}),l.el.setAttribute("data-dtime",m.secondToTime(0)),l.bar=h(l.el,"div",{className:"bar"}),e.addClass("current"),e.addEventListener(m.nameMap.dragStart,l.drag),n.scroll())},update(e){k(l.bar,Math.floor(e*100)+"%"),l.el.setAttribute("data-ptime",m.secondToTime(e*i.duration))},seeking(e){e?l.el.addClass("seeking"):l.el.removeClass("seeking")},percent(e,a){let t=((e.clientX||e.changedTouches[0].clientX)-P(a))/H(a);return t=Math.max(t,0),Math.min(t,1)},drag(e){e.preventDefault();let a=n.current().el,t=s=>{s.preventDefault();let o=l.percent(s,a);l.update(o),A.update(o*i.duration)},d=s=>{s.preventDefault(),a.removeEventListener(m.nameMap.dragEnd,d),a.removeEventListener(m.nameMap.dragMove,t);let o=l.percent(s,a);l.update(o),r.player.seek(o*i.duration),i.disableTimeupdate=!1,l.seeking(!1)};i.disableTimeupdate=!0,l.seeking(!0),a.addEventListener(m.nameMap.dragMove,t),a.addEventListener(m.nameMap.dragEnd,d)}},M={el:null,create(){let e=n.current();M.el.innerHTML='<div class="cover"><div class="disc"><img src="'+e.cover+'" class="blur"  alt="music cover"/></div></div><div class="info"><h4 class="title">'+e.name+"</h4><span>"+e.artist+'</span><div class="lrc"></div></div>',M.el.querySelector(".cover").addEventListener("click",r.player.options.events["play-pause"]),A.create(M.el.querySelector(".lrc"))}},i,n={el:null,data:[],index:-1,errnum:0,add:(e,a)=>{a.forEach(t=>{t.group=e,t.name=t.name||t.title||"Meida name",t.artist=t.artist||t.author||"Anonymous",t.cover=t.cover||t.pic,t.type=t.type||"normal",n.data.push(t)})},clear(){n.data=[],n.el.innerHTML="",n.index!==-1&&(n.index=-1,r.player.fetch())},create(){let e=n.el;n.data.map((a,t)=>{if(a.el)return null;let d="list-"+r.player._id+"-"+a.group,s=document.getElementById(d);return s||(s=h(e,"div",{id:d,className:r.player.group?"tab":"",innerHTML:"<ol></ol>"}),r.player.group&&(s.setAttribute("data-title",r.player.options.rawList[a.group].title),s.setAttribute("data-id",r.player._id))),a.el=h(s.querySelector("ol"),"li",{title:a.name+" - "+a.artist,innerHTML:'<span class="info"><span>'+a.name+"</span><span>"+a.artist+"</span></span>",onclick(o){let b=o.currentTarget;if(n.index===t&&l.el){i.paused?r.player.play():r.player.seek(i.duration*l.percent(o,b));return}r.player.switch(t),r.player.play()}}),a})},current(){return this.data[this.index]},scroll(){let e=this.current(),a=this.el.querySelector("li.active");a&&a.removeClass("active");let t=this.el.querySelector(".tab.active");return t&&t.removeClass("active"),a=this.el.querySelectorAll(".nav li")[e.group],a&&a.addClass("active"),t=this.el.querySelectorAll(".tab")[e.group],t&&t.addClass("active"),C(e.el,e.el.offsetTop),this},title(){if(i.paused)return;let e=this.current();document.title="Now Playing..."+e.name+" - "+e.artist+" | "+N},error(){let e=this.current();e.el.removeClass("current").addClass("error"),e.error=!0,this.errnum++}},T={el:null,create(){this.el||(this.el=h(r,"div",{className:"player-info",innerHTML:(r.player.options.type==="audio"?'<div class="preview"></div>':"")+'<div class="controller"></div><div class="playlist"></div>'},"after"),M.el=this.el.querySelector(".preview"),n.el=this.el.querySelector(".playlist"),u.el=this.el.querySelector(".controller"))},hide(){let e=this.el;e.addClass("hide"),window.setTimeout(()=>{e.removeClass("show hide")},300)}},y={type:"audio",mode:"random",btns:["play-pause","music"],controls:["mode","backward","play-pause","forward","volume"],events:{"play-pause"(e){i.paused?r.player.play():r.player.pause()},music(e){T.el.hasClass("show")?T.hide():(T.el.addClass("show"),n.scroll().title())}}},m={random(e){return Math.floor(Math.random()*e)},parse(e){let a=[];return[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song/(\\w+)(.html)?","tencent","song"],["y.qq.com.*album/(\\w+)(.html)?","tencent","album"],["y.qq.com.*singer/(\\w+)(.html)?","tencent","artist"],["y.qq.com.*playsquare/(\\w+)(.html)?","tencent","playlist"],["y.qq.com.*playlist/(\\w+)(.html)?","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]].forEach(t=>{let s=new RegExp(t[0]).exec(e);s!==null&&(a=[t[1],t[2],s[1]])}),a},fetch(e){let a=[];return new Promise((t,d)=>{e.forEach(s=>{let o=m.parse(s);if(o[0]){let b=JSON.stringify(o),x=f.get(b);x?(a.push(...JSON.parse(x)),t(a)):fetch(`${w.playerAPI}/meting/?server=`+o[0]+"&type="+o[1]+"&id="+o[2]+"&r="+Math.random()).then(v=>v.json()).then(v=>{f.set(b,JSON.stringify(v)),a.push(...v),t(a)}).catch(v=>{})}else a.push(s),t(a)})})},secondToTime(e){let a=o=>isNaN(o)?"00":o<10?"0"+o:""+o,t=Math.floor(e/3600),d=Math.floor((e-t*3600)/60),s=Math.floor(e-t*3600-d*60);return(t>0?[t,d,s]:[d,s]).map(a).join(":")},nameMap:{dragStart:j?"touchstart":"mousedown",dragMove:j?"touchmove":"mousemove",dragEnd:j?"touchend":"mouseup"}};i=null,r.player={_id:m.random(999999),group:!0,load(e){let a="";e&&e.length>0?this.options.rawList!==e&&(this.options.rawList=e,n.clear(),this.fetch()):(a="none",this.pause());for(let t in c.el)B(c.el[t],a);return this},fetch(){return new Promise((e,a)=>{if(n.data.length>0)e(!1);else if(this.options.rawList){let t=[];this.options.rawList.forEach((d,s)=>{t.push(new Promise((o,b)=>{let x=s,v;d.list?(this.group=!0,v=d.list):(x=0,this.group=!1,v=[d]),m.fetch(v).then(L=>{n.add(x,L),o(0)})}))}),Promise.all(t).then(()=>{e(!0)})}}).then(e=>{e&&(n.create(),u.create(),this.mode())})},mode(){let e=n.data.length;if(!e||n.errnum===e)return;let a=u.step==="next"?1:-1,t=()=>{let s=n.index+a;(s>e||s<0)&&(s=u.step==="next"?0:e-1),n.index=s},d=()=>{let s=m.random(e);n.index!==s?n.index=s:t()};switch(this.options.mode){case"random":d();break;case"order":t();break;case"loop":u.step&&t(),n.index===-1&&d();break}this.init()},switch(e){typeof e=="number"&&e!==n.index&&n.current()&&!n.current().error&&(n.index=e,this.init())},init(){let e=n.current();if(!e||e.error){this.mode();return}let a=!1;i.paused||(a=!0,this.stop()),i.setAttribute("src",e.url),i.setAttribute("title",e.name+" - "+e.artist),this.volume(f.get("_PlayerVolume")||"0.7"),this.muted(f.get("_PlayerMuted")),l.create(),this.options.type==="audio"&&M.create(),a===!0&&this.play()},play(){if(q&&q.player.pause(),n.current().error){this.mode();return}i.play().then(()=>{n.scroll()}).catch(e=>{})},pause(){i.pause(),document.title=N},stop(){i.pause(),i.currentTime=0,document.title=N},seek(e){e=Math.max(e,0),e=Math.min(e,i.duration),i.currentTime=e,l.update(e/i.duration)},muted(e){e==="muted"?(i.muted=e,f.set("_PlayerMuted",e),u.update(0)):(f.del("_PlayerMuted"),i.muted=!1,u.update(i.volume))},volume(e){isNaN(e)||(u.update(e),f.set("_PlayerVolume",e),i.volume=e)},mini(){T.hide()}};let A={el:null,data:null,index:0,create(e){let a=n.index,t=n.current().lrc,d=s=>{if(a!==n.index)return;this.data=this.parse(s);let o="";this.data.forEach((b,x)=>{o+="<p"+(x===0?' class="current"':"")+">"+b[1]+"</p>"}),this.el=h(e,"div",{className:"inner",innerHTML:o},"replace"),this.index=0};t.startsWith("http")?this.fetch(t,d):d(t)},update(e){if(this.data&&(this.index>this.data.length-1||e<this.data[this.index][0]||!this.data[this.index+1]||e>=this.data[this.index+1][0])){for(let a=0;a<this.data.length;a++)if(e>=this.data[a][0]&&(!this.data[a+1]||e<this.data[a+1][0])){this.index=a;let t=-(this.index-1);this.el.style.transform="translateY("+t+"rem)",this.el.getElementsByClassName("current")[0].removeClass("current"),this.el.getElementsByTagName("p")[a].addClass("current")}}},parse(e){if(e){e=e.replace(/([^\]^\n])\[/g,(s,o)=>o+`
[`);let a=e.split(`
`),t=[],d=a.length;for(let s=0;s<d;s++){let o=a[s].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),b=a[s].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").trim();if(o){let x=o.length;for(let v=0;v<x;v++){let L=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(o[v]),U=L[1]*60,W=parseInt(L[2]),G=L[4]?parseInt(L[4])/((L[4]+"").length===2?100:1e3):0,J=U+W+G;t.push([J,b])}}}return t=t.filter(s=>s[1]),t.sort((s,o)=>s[0]-o[0]),t}else return[]},fetch(e,a){fetch(e).then(t=>t.text()).then(t=>{a(t)}).catch(t=>{})}},F={onerror(){n.error(),r.player.mode()},ondurationchange(){i.duration!==1&&l.el.setAttribute("data-dtime",m.secondToTime(i.duration))},onloadedmetadata(){r.player.seek(0),l.el.setAttribute("data-dtime",m.secondToTime(i.duration))},onplay(){r.parentNode.addClass("playing"),D(this.getAttribute("title")),q=r},onpause(){r.parentNode.removeClass("playing"),q=null},ontimeupdate(){this.disableTimeupdate||(l.update(this.currentTime/this.duration),A.update(this.currentTime))},onended(e){r.player.mode(),r.player.play()}};return(e=>{r.player.created||(r.player.options=Object.assign(y,e),r.player.options.mode=f.get("_PlayerMode")||r.player.options.mode,c.create(),i=h(r,r.player.options.type,F),T.create(),r.parentNode.addClass(r.player.options.type),r.player.created=!0)})(p),r};g();var Me=r=>{let{text:p,parentNode:c,id:u,className:l,type:M,src:i,dataset:n}=r,T=p||r.textContent||r.innerHTML||"";c.removeChild(r);let y=document.createElement("script");u&&(y.id=u),l&&(y.className=l),M&&(y.type=M),i&&(y.src=i,y.async=!1),n.pjax!==void 0&&(y.dataset.pjax=""),T!==""&&y.appendChild(document.createTextNode(T)),c.appendChild(y)};g();var X=(r,p)=>{let c=w[r][p].url;return c.startsWith("https")?c:c.startsWith("http")?(console.warn(`Upgrade vendor ${r}/${p} to HTTPS, Please use HTTPS url instead of HTTP url.`),c.replace("http","https")):`/${c}`};var Se=(r,p)=>{if(!window["css"+r]&&LOCAL[r]){let c={rel:"stylesheet",href:X("css",r)},u=w.css[r];u.local||(c.integrity=u.sri,c.crossOrigin="anonymous"),h(document.head,"link",c),window["css"+r]=!0}};export{f as a,D as b,ee as c,te as d,re as e,ye as f,Me as g,Se as h};
/*! For license information please see chunk-YNVIU7S5.js.LEGAL.txt */
